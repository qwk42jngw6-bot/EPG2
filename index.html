<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EPG – Jetzt</title>
  <style>
    :root{--bg:#0f1419;--card:#151b23;--fg:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa;--border:#263140;}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif}
    main{max-width:1280px;margin:0 auto;padding:16px}
    .stamp{font-size:12px;color:var(--muted);margin:4px 0 12px}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}
    .card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px}
    .head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .name{font-weight:700}
    .no{font-size:12px;color:#93c5fd;background:#0b3b75;padding:2px 7px;border-radius:999px}
    .now{margin-bottom:8px}
    .title{font-weight:600}
    .time{font-size:12px;color:var(--muted)}
    .empty{color:#64748b;font-style:italic}
    .next{border-top:1px solid var(--border);margin-top:8px;padding-top:8px}
    .row{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:4px}
    .err{background:#3a0f13;color:#fecaca;border:1px solid #7f1d1d;border-radius:10px;padding:16px}
  </style>
</head>
<body>
<main>
  <div id="stamp" class="stamp">Lade…</div>
  <div id="host"></div>
</main>
<script>
const API = "https://waterfall-epg.w2gy9ymm7y.workers.dev";

async function loadEPG(){
  try{
    const r = await fetch(`${API}/api/now`);
    const data = await r.json();
    render(data);
  }catch(e){
    document.getElementById("host").innerHTML = `<div class="err">Fehler: ${e.message}</div>`;
  }
}
function hhmm(s){ const d=new Date(s); return d.toLocaleTimeString('de-DE',{hour:'2-digit',minute:'2-digit'}); }
function render(data){
  const items = data.items||[];
  const cards = items.map(it => {
    const now = it.now ? `
      <div class="now">
        <div class="title">${it.now.title}</div>
        <div class="time">${hhmm(it.now.start)} – ${hhmm(it.now.stop)}</div>
      </div>` : `<div class="empty">Keine aktuelle Sendung</div>`;
    const next = (it.next && it.next.length) ? `
      <div class="next">
        ${it.next.slice(0,2).map(n=>`<div class="row"><span>${n.title}</span><span>${hhmm(n.start)}</span></div>`).join("")}
      </div>` : "";
    return `<div class="card">
      <div class="head"><div class="name">${it.channel}</div><div class="no">#${it.no}</div></div>
      ${now}${next}
    </div>`;
  }).join("");
  document.getElementById("host").innerHTML = `<div class="grid">${cards}</div>`;
  if (data.ts) document.getElementById("stamp").textContent = "Stand: " + hhmm(data.ts);
}

loadEPG();
setInterval(loadEPG, 5*60*1000);
</script>
</body>
</html>
