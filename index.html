<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EPG – Jetzt (Germany 2)</title>
<style>
:root{
  --bg:#0b0f14; --card:#111822; --border:#1f2733;
  --text:#e8edf3; --muted:#9aa6b2;
  --accent:#67e8f9; --live:#86efac; --chip:#141b24;
  --gpt:#60a5fa; --imdb:#facc15; --rtU:#ef4444; --rtC:#22c55e;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Text", Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  font-size:14px; -webkit-font-smoothing:antialiased}
@media (max-width:420px){html,body{font-size:13px}}

header{padding:16px 18px;border-bottom:1px solid var(--border);
  position:sticky;top:0;background:linear-gradient(180deg,var(--bg),rgba(11,15,20,.94));backdrop-filter:saturate(180%) blur(8px);z-index:10}
h1{margin:0;font-size:22px;font-weight:900;letter-spacing:.2px}
.stamp{font-size:12px;color:var(--muted);margin-top:2px}

.container{padding:16px 14px;max-width:1120px;margin:0 auto}
.grid{display:grid;gap:12px}
@media(min-width:760px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(min-width:1100px){.grid{grid-template-columns:repeat(3,1fr)}}

.card{background:var(--card);border:1px solid var(--border);
  border-radius:14px;padding:14px 14px 12px;box-shadow:0 1px 0 rgba(255,255,255,.03) inset}
.top{display:flex;align-items:baseline;justify-content:space-between;margin-bottom:8px}
.ch{font-size:16px;font-weight:900;letter-spacing:.2px}
.no{font-size:11px;color:var(--muted);background:var(--chip);padding:2px 8px;border-radius:999px;border:1px solid var(--border)}
.now{font-weight:800;color:var(--live)}
.time{color:var(--accent)}
.muted{color:var(--muted)}
.warn{color:#facc15}
ul{padding-left:18px;margin:8px 0 2px}
.badge{display:inline-block;background:var(--chip);border:1px solid var(--border);
  padding:3px 8px;border-radius:10px;margin-right:6px;font-size:12px}
.badge.gpt{color:var(--gpt); border-color:color-mix(in oklab, var(--gpt) 60%, #000)}
.badge.imdb{color:var(--imdb); border-color:color-mix(in oklab, var(--imdb) 60%, #000)}
.badge.rtU{color:var(--rtU); border-color:color-mix(in oklab, var(--rtU) 60%, #000)}
.badge.rtC{color:var(--rtC); border-color:color-mix(in oklab, var(--rtC) 60%, #000)}
.row{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
.small{font-size:12px;color:var(--muted);margin-top:6px}
.aside{display:none} /* Platzhalter für künftige Live-Interesse */
</style>
</head>
<body>
<header>
  <h1>EPG – Jetzt</h1>
  <div id="stamp" class="stamp"></div>
</header>

<div class="container">
  <div id="root" class="grid"></div>
</div>

<script>
const api="/api/now";
const $=s=>document.querySelector(s);
const stamp=$("#stamp"),root=$("#root");
const tt=d=>new Date(d).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});

function nextList(arr){
  if(!arr||!arr.length) return '<div class="muted">Keine weiteren Sendungen.</div>';
  return `<ul>${arr.slice(0,2).map(p=>`<li>${p.title} <span class="time">(${tt(p.start)}–${tt(p.stop)})</span></li>`).join("")}</ul>`;
}
function ratings(r){
  if(!r) return "";
  const chips=[];
  if(r.gpt!=null) chips.push(`<span class="badge gpt">GPT ${r.gpt}/10</span>`);
  if(r.imdb!=null) chips.push(`<span class="badge imdb">IMDb ${r.imdb}</span>`);
  if(r.rtUser!=null) chips.push(`<span class="badge rtU">RT-User ${r.rtUser}%</span>`);
  if(r.rtCritic!=null) chips.push(`<span class="badge rtC">RT-Kritik ${r.rtCritic}%</span>`);
  return chips.length? `<div class="row">${chips.join("")}</div>` : "";
}

async function load(){
  stamp.textContent="Lade…";
  try{
    const r=await fetch(api,{cache:"no-store"});
    const j=await r.json();
    stamp.textContent="Stand: "+new Date(j.ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});
    root.innerHTML="";
    for(const it of j.items){
      const card=document.createElement("div"); card.className="card";
      const head=`<div class="top"><div class="ch">${it.channel}</div><span class="no">#${it.no}</span></div>`;
      if(!it.now){
        card.innerHTML=head+`<div class="warn">Kein aktuelles Programm gefunden</div>`;
      }else{
        const when = it.now.start && it.now.stop ? ` <span class="time">(${tt(it.now.start)}–${tt(it.now.stop)})</span>` : "";
        card.innerHTML=head+`<div class="now">${it.now.title}${when}</div>`+nextList(it.next)+ratings(it.rating)
          + (it.original ? `<div class="small">Original: ${it.original}</div>` : "");
      }
      root.appendChild(card);
    }
  }catch(e){
    stamp.textContent="Fehler: "+(e?.message||e);
  }
}
load();
</script>
</body>
</html>
